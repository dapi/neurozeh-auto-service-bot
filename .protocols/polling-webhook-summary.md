# ะัะฐัะบะธะน ะพะฑะทะพั: ะะพะดะดะตัะถะบะฐ Polling ะธ Webhook ัะตะถะธะผะพะฒ

## ๐ ะกััั

ะะตะฐะปะธะทะพะฒะฐัั ะฒะพะทะผะพะถะฝะพััั ะทะฐะฟััะบะฐ ะฑะพัะฐ ะฒ **ะดะฒัั ัะตะถะธะผะฐั**:

1. **Polling** (ัะตะบััะธะน) - ะฑะพั ัะฐะผ ะพะฟัะฐัะธะฒะฐะตั Telegram ะบะฐะถะดัะต 30 ัะตะบ
2. **Webhook** (ะฝะพะฒัะน) - Telegram ะพัะฟัะฐะฒะปัะตั ะพะฑะฝะพะฒะปะตะฝะธั ะฝะฐ ัะตัะฒะตั ะฑะพัะฐ

---

## ๐ฏ ะงัะพ ะฝัะถะฝะพ ัะดะตะปะฐัั

### ะะพะฒัะต ัะฐะนะปั (3 ัั)

```
lib/
โโโ bot_launcher.rb        (ัะฐะฑัะธะบะฐ ะดะปั ะฒัะฑะพัะฐ ัะตะถะธะผะฐ)
โโโ polling_starter.rb     (ััะฐััะตั ะดะปั polling)
โโโ webhook_starter.rb     (ััะฐััะตั ะดะปั webhook + HTTP ัะตัะฒะตั)
```

### ะะฑะฝะพะฒะปะตะฝะฝัะต ัะฐะนะปั (4 ัั)

```
config/app_config.rb        (ะดะพะฑะฐะฒะธัั ะฟะฐัะฐะผะตััั bot_mode, webhook_url, etc.)
lib/telegram_bot_handler.rb (ัะตัะฐะบัะพัะธะฝะณ: ะดะพะฑะฐะฒะธัั handle_update + send_message)
bot.rb                      (ะทะฐะผะตะฝะธัั telegram_bot_handler.start ะฝะฐ launcher.start)
.env.example                (ะดะพะฑะฐะฒะธัั ะฝะพะฒัะต ะฟะตัะตะผะตะฝะฝัะต)
```

### ะขะตัั ัะฐะนะปั (3 ัั)

```
test/test_bot_launcher.rb
test/test_polling_starter.rb
test/test_webhook_starter.rb
```

---

## โก ะัััััะน ััะฐัั

### Polling ัะตะถะธะผ (ะฟะพ ัะผะพะปัะฐะฝะธั, ะฝะธัะตะณะพ ะฝะต ะผะตะฝัะตััั)
```bash
BOT_MODE=polling
ruby bot.rb
```

### Webhook ัะตะถะธะผ (ะฝะพะฒัะน)
```bash
BOT_MODE=webhook
WEBHOOK_URL=https://mybot.example.com
WEBHOOK_PORT=3000
ruby bot.rb
```

---

## ๐ ะกัะฐะฒะฝะตะฝะธะต

| | Polling | Webhook |
|---|---|---|
| ะกะบะพัะพััั | ~30 ัะตะบ | ~20ms |
| API calls/ะดะตะฝั | 2880 | 0 |
| HTTPS | โ | โ |
| Production | โ | โ |

---

## ๐ ะะพะบัะผะตะฝัะฐัะธั

ะัะต ะดะพะบัะผะตะฝัั ะฝะฐัะพะดัััั ะฒ `.protocols/`:

1. **polling-webhook-spec.md** - ะะพะปะฝะฐั ัะฟะตัะธัะธะบะฐัะธั (ะฐััะธัะตะบัััะฐ, API, ััะตะฑะพะฒะฐะฝะธั)
2. **polling-webhook-implementation.md** - ะะพัะฐะณะพะฒัะน ะฟะปะฐะฝ ะธะผะฟะปะตะผะตะฝัะฐัะธะธ (ะบะพะด, ัะตััั)
3. **polling-webhook-examples.md** - ะัะธะผะตัั, ะปะพะณะธ, ะดะธะฐะณะฝะพััะธะบะฐ
4. **polling-webhook-summary.md** - ะญัะพั ัะฐะนะป (ะบัะฐัะบะธะน ะพะฑะทะพั)

---

## ๐ง ะััะธัะตะบัััะฐ (ัะฟัะพัะตะฝะฝะฐั)

```
โโโโโโโโโโโโโโโโโโโโโโโ
โ  BotLauncher        โ
โ  - ะัะฑะธัะฐะตั ัะตะถะธะผ   โ
โโโโโโโโโโโโฌโโโโโโโโโโโ
           โ
    โโโโโโโโดโโโโโโ
    โผ             โผ
โโโโโโโโโโโ  โโโโโโโโโโโโ
โPolling  โ  โWebhook   โ
โStarter  โ  โStarter   โ
โโโโโโฌโโโโโ  โโโโโโฌโโโโโโ
     โ            โ
     โโโโโโโโฌโโโโโโ
            โผ
    โโโโโโโโโโโโโโโโโโโโ
    โTelegramBotHandlerโ
    โ  handle_update() โ
    โโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ัะฐะฑะพั

1. โ ะกะฟะตัะธัะธะบะฐัะธั ะฝะฐะฟะธัะฐะฝะฐ (polling-webhook-spec.md)
2. โ ะะปะฐะฝ ะธะผะฟะปะตะผะตะฝัะฐัะธะธ ะณะพัะพะฒ (polling-webhook-implementation.md)
3. โ ะัะธะผะตัั ะธ ะดะธะฐะณะฝะพััะธะบะฐ ะตััั (polling-webhook-examples.md)
4. โณ ะะพัะพะฒ ะบ ะธะผะฟะปะตะผะตะฝัะฐัะธะธ

---

## ๐ ะกะปะตะดัััะธะต ัะฐะณะธ

1. ะะฐัะฐัั ั **AppConfig** (ะดะพะฑะฐะฒะธัั ะฝะพะฒัะต ะฟะฐัะฐะผะตััั)
2. ะกะพะทะดะฐัั **PollingStarter** (ะฟัะพััะพะน wraper)
3. ะกะพะทะดะฐัั **WebhookStarter** (ะฑะพะปะตะต ัะปะพะถะฝัะน)
4. ะกะพะทะดะฐัั **BotLauncher** (ัะฐะฑัะธะบะฐ)
5. ะะฑะฝะพะฒะธัั **TelegramBotHandler** (handle_update)
6. ะะฑะฝะพะฒะธัั **bot.rb** (ะธัะฟะพะปัะทะพะฒะฐัั launcher)
7. ะะฐะฟะธัะฐัั **ัะตััั**
8. ะะฑะฝะพะฒะธัั **README.md**

---

## ๐ก ะะปััะตะฒัะต ะผะพะผะตะฝัั

- **Polling ัะตะถะธะผ** ะพััะฐะตััั ะบะฐะบ fallback ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ
- **Webhook ัะตะถะธะผ** ะฟะพะดัะพะดะธั ะดะปั production
- **ะะฑะฐ ัะตะถะธะผะฐ ะธัะฟะพะปัะทััั ะพะดะธะฝะฐะบะพะฒัั ะปะพะณะธะบั ะพะฑัะฐะฑะพัะบะธ** (TelegramBotHandler)
- **ะะพะฝัะธะณััะฐัะธั ัะฟัะฐะฒะปัะตััั ัะตัะตะท .env** (BOT_MODE, WEBHOOK_URL, etc.)
- **ะขะตััะธัะพะฒะฐะฝะธะต ะฒะบะปััะฐะตั unit + integration ัะตััั**

---

## ๐ ะะพะปะตะทะฝัะต ัััะปะบะธ

- [Telegram Bot API - getUpdates](https://core.telegram.org/bots/api#getupdates)
- [Telegram Bot API - setWebhook](https://core.telegram.org/bots/api#setwebhook)
- [Telegram Bot API - getWebhookInfo](https://core.telegram.org/bots/api#getwebhookinfo)

---

## โ FAQ

**Q: ะะพัะตะผั ะฝัะถะฝั ะดะฒะฐ ัะตะถะธะผะฐ?**
A: Polling ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ (ะฝะตั HTTPS), Webhook ะดะปั production (ะฑััััะตะต, ัััะตะบัะธะฒะฝะตะต)

**Q: ะะพะถะฝะพ ะปะธ ะฟะตัะตะบะปััะฐัััั ะผะตะถะดั ัะตะถะธะผะฐะผะธ?**
A: ะะฐ! ะัะพััะพ ะธะทะผะตะฝะธัะต `BOT_MODE` ะฒ .env ะธ ะฟะตัะตะทะฐะฟัััะธัะต ะฑะพัะฐ

**Q: ะัะดัั ะปะธ ะฟัะพะฑะปะตะผั ัะพะฒะผะตััะธะผะพััะธ?**
A: ะะตั! ะกััะตััะฒัััะธะน ะบะพะด polling ัะตะถะธะผะฐ ะฝะต ะธะทะผะตะฝะธััั, webhook ะฑัะดะตั ะพะฟัะธะพะฝะฐะปัะฝัะน

**Q: ะกะบะพะปัะบะพ ะฒัะตะผะตะฝะธ ะทะฐะนะผะตั?**
A: ~4-6 ัะฐัะพะฒ ะดะปั ะพะฟััะฝะพะณะพ ัะฐะทัะฐะฑะพััะธะบะฐ

**Q: ะัะถะฝะพ ะปะธ ะผะตะฝััั ะบะพะด TelegramBotHandler?**
A: ะะธะฝะธะผะฐะปัะฝะพ - ัะพะปัะบะพ ะดะพะฑะฐะฒะธัั ะผะตัะพะดั `handle_update()` ะธ `send_message()`

---

## โจ ะัะตะธะผััะตััะฒะฐ

1. โ ะะธะฑะบะพััั: ะฒัะฑะพั ัะตะถะธะผะฐ ัะตัะตะท .env
2. โ ะัะพััะพัะฐ: polling ะดะปั ัะฐะทัะฐะฑะพัะบะธ, webhook ะดะปั production
3. โ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั: webhook ะฒ 150 ัะฐะท ะฑััััะตะต
4. โ ะะฐะดะตะถะฝะพััั: webhook ะฝะฐะดะตะถะฝะตะต polling
5. โ ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั: ััะฐััะน ะบะพะด ัะฐะฑะพัะฐะตั ะฑะตะท ะธะทะผะตะฝะตะฝะธะน

