# –ê–≤—Ç–æ-–°–µ—Ä–≤–∏—Å –ë–æ—Ç (auto-service-bot) - Telegram Bot AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –ó–∞–ø–∏—Å–∏ –Ω–∞ –ê–≤—Ç–æ-–£—Å–ª—É–≥–∏

Telegram –±–æ—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ —É—Å–ª—É–≥–∏ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞.

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≤–µ–¥–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –æ —É—Å–ª—É–≥–∞—Ö –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞.
–ë–æ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏–º–µ–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç —Å–ø–∞–º–∞ —á–µ—Ä–µ–∑ Rate Limiter.

## üöÄ Quick Start

**–•–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ –Ω–∞—á–∞—Ç—å?** –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—É—Ç—å:

- üéØ **[–Ø –Ω–æ–≤–∏—á–æ–∫](#-–ó–∞–ø—É—Å–∫-—á–µ—Ä–µ–∑-docker-–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è-–¥–ª—è-–ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)** - Docker Compose (–ø—Ä–æ—Å—Ç–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ)
- üõ†Ô∏è **[–Ø —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫](#Ô∏è-–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞-—Å-dip-–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)** - Dip (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
- ‚ö° **[–Ø —Ö–æ—á—É –ª–æ–∫–∞–ª—å–Ω–æ](#-–ó–∞–ø—É—Å–∫-–±–µ–∑-docker-–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)** - –ë–µ–∑ Docker (–±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç)

## üöÄ –°–ø–æ—Å–æ–±—ã –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞

| –°–ø–æ—Å–æ–± | –î–ª—è –∫–æ–≥–æ | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ |
|--------|----------|---------------|------------|
| **Docker + Dip** | –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ | üí™ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, üîß –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, üîÑ –ë—ã—Å—Ç—Ä—ã–π workflow | üê≥ –¢—Ä–µ–±—É–µ—Ç—Å—è Docker |
| **Docker Compose** | –ü—Ä–æ–¥–∞–∫—à–µ–Ω, DevOps | üöÄ –ì–æ—Ç–æ–≤—ã–π –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É, üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, üì¶ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è | üê¢ –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞** | –ù–æ–≤–∏—á–∫–∏, –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç | ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç, üéì –õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å, üíª –ú–∏–Ω–∏–º—É–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π | ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏, üîÑ –°–ª–æ–∂–Ω—ã–π setup |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Dip** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, **Docker Compose** –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.

---

## üöÄ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Docker Compose

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   ```bash
   git clone https://github.com/yourusername/auto-service-bot.git
   cd auto-service-bot
   ```

2. **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
   ```bash
   cp .env.example .env
   ```

3. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `.env` —Ñ–∞–π–ª:**
   ```bash
   nano .env
   ```

   –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   ```
   TELEGRAM_BOT_TOKEN=your_telegram_bot_token
   ADMIN_CHAT_ID=123456789  # ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞—è–≤–∫–∞—Ö
   ```

4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
   ```bash
   docker-compose run --rm auto-service-bot rake db:create
   docker-compose run --rm auto-service-bot rake db:migrate
   docker-compose run --rm auto-service-bot rake ruby_llm:load_models
   ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:**
   ```bash
   docker-compose up -d
   ```

6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:**
   ```bash
   docker-compose logs -f auto-service-bot
   ```

### –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

#### –î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ (–ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)

**–®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker**

**Ubuntu/Debian:**
```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
# –ü–µ—Ä–µ–∑–∞–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
```

**MacOS:**
- –°–∫–∞—á–∞–π—Ç–µ Docker Desktop —Å [docker.com](https://www.docker.com/products/docker-desktop)

**Windows:**
- –°–∫–∞—á–∞–π—Ç–µ Docker Desktop —Å [docker.com](https://www.docker.com/products/docker-desktop)

**–®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)**

```bash
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

**–®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤**

1. **Telegram Bot Token:**
   - –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/botfather) –≤ Telegram
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
   - –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

2. **Anthropic API Key:**
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [platform.anthropic.com](https://console.anthropic.com)
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ API Keys
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á

**–®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫**

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/yourusername/auto-service-bot.git
cd auto-service-bot

# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
cp .env.example .env

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nano .env
```

**–®–∞–≥ 5: –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞**

```bash
# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f auto-service-bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞
docker-compose down
```

#### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø—Ü–∏–∏

**–ó–∞–ø—É—Å–∫ —Å webhook —Ä–µ–∂–∏–º–æ–º:**

1. –ò–∑–º–µ–Ω–∏—Ç–µ `.env` —Ñ–∞–π–ª:
   ```
   BOT_MODE=webhook
   WEBHOOK_URL=https://your-domain.com
   WEBHOOK_PORT=3000
   WEBHOOK_HOST=0.0.0.0
   ```

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ (Nginx example):
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;

       location / {
           proxy_pass http://localhost:3000;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
   }
   ```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
docker-compose exec auto-service-bot pgrep -f "ruby bot.rb"

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats auto-service-bot
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:**

```bash
# –°–∫–∞—á–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é
docker-compose pull

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å –Ω–æ–≤—ã–º –æ–±—Ä–∞–∑–æ–º
docker-compose up -d

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–∑
docker image prune -f
```

### –°–±–æ—Ä–∫–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t auto-service-bot .

# –ó–∞–ø—É—Å–∫
docker run -d \
  --name auto-service-bot \
  --env-file .env \
  auto-service-bot
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è GitHub Actions. –ü—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É:

1. –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–µ—Å—Ç—ã
2. –°–æ–±–∏—Ä–∞–µ—Ç—Å—è Docker –æ–±—Ä–∞–∑
3. –û–±—Ä–∞–∑ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ GitHub Container Registry (GHCR)
4. –°–æ–∑–¥–∞–µ—Ç—Å—è SBOM (Software Bill of Materials)

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
docker-compose pull && docker-compose up -d
```

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Docker

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `docker-compose up -d` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ |
| `docker-compose down` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã |
| `docker-compose logs -f` | –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ |
| `docker-compose restart` | –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä |
| `docker-compose exec auto-service-bot bash` | –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä |
| `docker stats auto-service-bot` | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ |

## üõ†Ô∏è –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å Dip (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**Dip** - —ç—Ç–æ CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ —Ç–∞–∫–æ–π –∂–µ —É–¥–æ–±–Ω–æ–π, –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Dip

```bash
# –ì–ª–æ–±–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
gem install dip

# –ò–ª–∏ —á–µ—Ä–µ–∑ Bundler (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
bundle add dip --group development
```

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Dip

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Dip:**
   ```bash
   gem install dip
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
   ```bash
   dip setup
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
   ```bash
   dip up
   dip bot
   ```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Dip

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–Ω–∞–ª–æ–≥ Docker |
|---------|----------|---------------|
| `dip bash` | –û—Ç–∫—Ä—ã—Ç—å shell –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ | `docker-compose exec auto-service-bot bash` |
| `dip bot` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ | `docker-compose up auto-service-bot` |
| `dip test` | –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã | `docker-compose exec auto-service-bot bundle exec rake test` |
| `dip rubocop` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ —Å—Ç–∏–ª–µ–º | `docker-compose exec auto-service-bot bundle exec rubocop` |
| `dip logs` | –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞ | `docker-compose logs -f auto-service-bot` |
| `dip restart` | –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ | `docker-compose restart auto-service-bot` |
| `dip down` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã | `docker-compose down` |

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Dip

#### Shell –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (—Å—É–ø–µ—Ä-—É–¥–æ–±–Ω–æ!)

–í–∫–ª—é—á–∏—Ç–µ shell –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ `dip`:

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ ~/.zshrc –∏–ª–∏ ~/.bashrc
echo 'eval "$(dip console)"' >> ~/.zshrc
source ~/.zshrc
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –Ω–∞–ø—Ä—è–º—É—é:
```bash
# –í–º–µ—Å—Ç–æ dip bundle exec rake test
bundle exec rake test

# –í–º–µ—Å—Ç–æ dip bash
bash

# –í–º–µ—Å—Ç–æ dip logs
logs
```

#### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –∑–∞–π—Ç–∏ –≤ shell
dip up
dip bash

# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
# - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
bundle install

# - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
rake db:create
rake db:migrate
rake ruby_llm:load_models

# - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
rake test

# - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
ruby bot.rb
```

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–æ–¥–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∏–ª—å –∫–æ–¥–∞
dip rubocop

# –ê–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª—è
dip rubocop-autocorrect

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
dip test

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
dip minitest test/test_rate_limiter.rb
```

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º

```bash
# –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
dip setup

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
dip health

# –û—á–∏—Å—Ç–∏—Ç—å Docker —Ä–µ—Å—É—Ä—Å—ã
dip clean

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
dip down && dip up
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Dip

–§–∞–π–ª `dip.yml` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

- **Shell –∫–æ–º–∞–Ω–¥—ã**: `bash`, `sh`, `console`
- **Ruby –∫–æ–º–∞–Ω–¥—ã**: `bundle`, `ruby`, `rake`
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: `test`, `minitest`, `rspec`
- **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: `rubocop`, `rubocop-autocorrect`
- **Bot –∫–æ–º–∞–Ω–¥—ã**: `bot`, `bot-console`
- **Docker shortcuts**: `up`, `down`, `restart`, `logs`

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å Dip

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
git clone https://github.com/yourusername/auto-service-bot.git
cd auto-service-bot
dip setup

# 2. –ó–∞–ø—É—Å–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è
dip up

# 3. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
dip bash
# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
# - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
# - –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã: rake test
# - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∏–ª—å: rubocop
# - –ó–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞: ruby bot.rb

# 4. –ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
dip rubocop
dip test

# 5. –û—á–∏—Å—Ç–∫–∞
dip down
```

**Dip –¥–µ–ª–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Å Docker —Ç–∞–∫–æ–π –∂–µ —É–¥–æ–±–Ω–æ–π, –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞!**

### üìñ –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å Dip –∏ Docker, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ **[DEVELOPMENT.md](DEVELOPMENT.md)** - —Ç–∞–º –≤—ã –Ω–∞–π–¥–µ—Ç–µ:

- üöÄ –ü–æ–¥—Ä–æ–±–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –æ–∫—Ä—É–∂–µ–Ω–∏—è
- üõ†Ô∏è –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏ workflow
- üêõ Troubleshooting —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º
- üîÑ CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- üéØ –°–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

# –ó–∞–ø—É—Å–∫ –±–µ–∑ Docker (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ Docker:

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
git clone https://github.com/yourusername/auto-service-bot.git
cd auto-service-bot
bundle install
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
nano .env
```

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
rake db:create

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
rake db:migrate

# –ó–∞–≥—Ä—É–∑–∫–∞ LLM –º–æ–¥–µ–ª–µ–π
rake ruby_llm:load_models
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
ruby bot.rb
```

### 5. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
rake test
```

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –∫–æ–¥–∞

```bash
bundle exec rubocop
```

---

–ë–æ—Ç —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ Plan&Act —á–µ—Ä–µ–∑ Claude Code AI.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Ruby >= 3.2.0
- Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å –º–æ–∂–Ω–æ —É [@BotFather](https://t.me/botfather))
- Anthropic API Key (–ø–æ–ª—É—á–∏—Ç—å –º–æ–∂–Ω–æ –Ω–∞ [platform.anthropic.com](https://console.anthropic.com))

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
git clone <repository>
cd auto-service-bot
bundle install
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `.env`:

```
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
ADMIN_CHAT_ID=123456789
SYSTEM_PROMPT_PATH=./system-prompt.md
RATE_LIMIT_REQUESTS=10
RATE_LIMIT_PERIOD=60
MAX_HISTORY_SIZE=10
LOG_LEVEL=info
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
ruby bot.rb
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram User  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ Message
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  TelegramBotHandler      ‚îÇ
‚îÇ  - –°–ª—É—à–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è    ‚îÇ
‚îÇ  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚îú‚îÄ‚îÄ‚ñ∂ RateLimiter
           ‚îÇ    - –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
           ‚îÇ
           ‚îú‚îÄ‚îÄ‚ñ∂ ConversationManager
           ‚îÇ    - –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤
           ‚îÇ    - –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π
           ‚îÇ
           ‚îî‚îÄ‚îÄ‚ñ∂ ClaudeClient
                - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ Claude API
                - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ + 1 retry
                - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–§–ê–ó–ê 1)

### RateLimiter (`lib/rate_limiter.rb`)

–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 60 —Å–µ–∫—É–Ω–¥
- In-memory —Å—á–µ—Ç—á–∏–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–æ–π —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π

### ConversationManager (`lib/conversation_manager.rb`)

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤:
- –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π (–ª–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
- –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∫–æ–º–∞–Ω–¥–µ `/start`
- Thread-safe —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Mutex

### ClaudeClient (`lib/claude_client.rb`)

HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å Claude API:
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –¥–∏–∞–ª–æ–≥–∞
- –ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å 1 retry –ø–æ–ø—ã—Ç–∫–æ–π
- –ü–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–æ–≤

### TelegramBotHandler (`lib/telegram_bot_handler.rb`)

–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞:
- –°–ª—É—à–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram API
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É `/start` (–æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç RateLimiter –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ Claude –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è

### AppConfig (`config/app_config.rb`)

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ `anyway_config`:
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env` —Ñ–∞–π–ª–∞
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|---|---|---|---|
| `OPENAI_API_BASE` | OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API endpoint (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è z.ai) | ‚ùå | –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ |
| `SYSTEM_PROMPT_PATH` | –ü—É—Ç—å –∫ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –ø—Ä–æ–º–ø—Ç—É | ‚ùå | `./system-prompt.md` |
| `TELEGRAM_BOT_TOKEN` | Token Telegram –±–æ—Ç–∞ | ‚úÖ | - |
| `PRICE_LIST_PATH` | –ü—É—Ç—å –∫ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—É CSV | ‚ùå | `./data/–∫—É–∑–Ω–∏–∫.csv` |
| `RATE_LIMIT_REQUESTS` | –ö–æ–ª-–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ª–∏–º–∏—Ç–µ | ‚ùå | `10` |
| `RATE_LIMIT_PERIOD` | –ü–µ—Ä–∏–æ–¥ –ª–∏–º–∏—Ç–∞ (–≤ —Å–µ–∫) | ‚ùå | `60` |
| `MAX_HISTORY_SIZE` | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ | ‚ùå | `10` |
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | ‚ùå | `info` |
| `ADMIN_CHAT_ID` | ID –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ —á–∞—Ç–∞ | ‚ùå | `123456789` |

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ gem ruby_llm (v1.8.2)

#### API –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ LLM

- `OPENAI_API_KEY` - API –∫–ª—é—á –¥–ª—è OpenAI
- `ANTHROPIC_API_KEY` - API –∫–ª—é—á –¥–ª—è Anthropic Claude
- `GEMINI_API_KEY` - API –∫–ª—é—á –¥–ª—è Google Gemini
- `DEEPSEEK_API_KEY` - API –∫–ª—é—á –¥–ª—è DeepSeek
- `PERPLEXITY_API_KEY` - API –∫–ª—é—á –¥–ª—è Perplexity
- `OPENROUTER_API_KEY` - API –∫–ª—é—á –¥–ª—è OpenRouter
- `MISTRAL_API_KEY` - API –∫–ª—é—á –¥–ª—è Mistral AI

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ruby_llm

- `RUBYLLM_DEBUG` - –í–∫–ª—é—á–µ–Ω–∏–µ debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–ª—é–±–æ–µ –Ω–µ–ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç DEBUG —É—Ä–æ–≤–µ–Ω—å)
- `RUBYLLM_STREAM_DEBUG` - –í–∫–ª—é—á–µ–Ω–∏–µ debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ (–∑–Ω–∞—á–µ–Ω–∏–µ `true`)

### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è z.ai

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ API –æ—Ç z.ai —Å OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º endpoint:

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –° —è–≤–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º OpenAI endpoint (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
export ANTHROPIC_AUTH_TOKEN=your_z_ai_api_key
export TELEGRAM_BOT_TOKEN=your_telegram_bot_token
export OPENAI_API_BASE=https://api.z.ai/api/paas/v4

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
ruby bot.rb
```

–ò–ª–∏ –≤ `.env` —Ñ–∞–π–ª–µ:
```
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
OPENAI_API_BASE=https://api.z.ai/api/paas/v4
LLM_PROVIDER=anthropic
LLM_MODEL=glm-4.5-air
```

–ü—Ä–∏ —è–≤–Ω–æ–º —É–∫–∞–∑–∞–Ω–∏–∏ `OPENAI_API_BASE` –±–æ—Ç –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –±—ã—Å—Ç—Ä–µ–µ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ.

## –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
.
‚îú‚îÄ‚îÄ Gemfile                    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ Gemfile.lock              # –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
‚îú‚îÄ‚îÄ Rakefile                  # Rake –∑–∞–¥–∞—á–∏ (—Ç–µ—Å—Ç—ã)
‚îú‚îÄ‚îÄ README.md                 # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ .env.example              # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ .gitignore                # Git –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ bot.rb                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ system-prompt.md          # –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è Claude
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ app_config.rb         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ claude_client.rb      # HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è Claude API
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot_handler.rb # –û–±—Ä–∞–±–æ—Ç–∫–∞ Telegram —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ conversation_manager.rb # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ rate_limiter.rb       # –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
‚îÇ
‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îú‚îÄ‚îÄ test_helper.rb        # –ö–æ–Ω—Ñ–∏–≥ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ test_rate_limiter.rb
‚îÇ   ‚îú‚îÄ‚îÄ test_claude_client.rb
‚îÇ   ‚îú‚îÄ‚îÄ test_conversation_manager.rb
‚îÇ   ‚îî‚îÄ‚îÄ test_app_config.rb
‚îÇ
‚îú‚îÄ‚îÄ .protocols/
‚îÇ   ‚îî‚îÄ‚îÄ plan.md               # –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ
‚îî‚îÄ‚îÄ data/
    ‚îî‚îÄ‚îÄ –∫—É–∑–Ω–∏–∫.csv            # –ü—Ä–∞–π—Å-–ª–∏—Å—Ç —É—Å–ª—É–≥
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–æ–º

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∞–π—Å-–ª–∏—Å—Ç –∏–∑ CSV —Ñ–∞–π–ª–∞ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è:
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É—Å–ª—É–≥
- –†–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ –∫–ª–∞—Å—Å–∞–º –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª—É–≥

### –ü—É—Ç—å –∫ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—É

–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `PRICE_LIST_PATH`:
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `./data/–∫—É–∑–Ω–∏–∫.csv`
- –§–æ—Ä–º–∞—Ç: CSV —Å UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
- –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏ –±—ã—Ç—å —á–∏—Ç–∞–µ–º—ã–º –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç anyway_config –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –§–∞–π–ª–æ–≤—ã–µ –ø—É—Ç–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
- –ß–∏—Å–ª–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π
- –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞ `system-prompt.md` –∏ –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç—Å—è —Å –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–æ–º. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–æ—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ —É—Å–ª—É–≥–∞—Ö –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏.

–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ API:

```json
{
  "model": "glm-4.5-air",
  "max_tokens": 1500,
  "system": "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ + –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∞–π—Å-–ª–∏—Å—Ç...",
  "messages": [
    {"role": "user", "content": "–ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"},
    {"role": "assistant", "content": "–û—Ç–≤–µ—Ç Claude"},
    ...
  ]
}
```

## –¢–µ—Å—Ç—ã

–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:

```bash
rake test
```

–¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:
- RateLimiter (6 —Ç–µ—Å—Ç–æ–≤)
- ConversationManager (7 —Ç–µ—Å—Ç–æ–≤)
- ClaudeClient (3 —Ç–µ—Å—Ç–∞)
- AppConfig (5 —Ç–µ—Å—Ç–æ–≤)

–ò—Ç–æ–≥–æ: 21 unit —Ç–µ—Å—Ç

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ë–æ—Ç –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:
- –û—à–∏–±–∫–∏ API Claude: –ø—Ä–æ—Å—Ç–æ–π rescue –±–ª–æ–∫ + 1 retry –ø–æ–ø—ã—Ç–∫–∞
- –û—à–∏–±–∫–∏ Telegram API: –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É—Ä–æ–≤–Ω–µ–º `error` –∏–ª–∏ `warn`

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–§–ê–ó–ê 2)

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ MVP, –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:

- MessageHandlers —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º Strategy
- TokenManager —Å —Ç–æ—á–Ω—ã–º –ø–æ–¥—Å—á–µ—Ç–æ–º —Ç–æ–∫–µ–Ω–æ–≤
- Circuit Breaker –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
- StructuredLogger –¥–ª—è JSON –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- AsyncMessageProcessor –¥–ª—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- Metrics –∏ health checks
- Prompt caching –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- Graceful shutdown

–î–µ—Ç–∞–ª–∏ —Å–º. –≤ `.protocols/plan.md` –∏ `.protocols/plan-must-have.md`

## –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π Mozilla Public License 2.0 (MPL-2.0).

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è –ª–∏—Ü–µ–Ω–∑–∏–∏:

- **–†–∞–∑—Ä–µ—à–∞–µ—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ü–µ–ª—è—Ö
- **–¢—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞** - –µ—Å–ª–∏ –≤—ã –≤–Ω–æ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥ –ø–æ–¥ MPL, –≤—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–°–ª–∞–±–æ–µ –∫–æ–ø–∏–ª–µ—Ñ—Ç** - —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã, –∞ –Ω–µ –Ω–∞ –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä—Å—Ç–≤–∞** - –≤—ã –¥–æ–ª–∂–Ω—ã —É–∫–∞–∑–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞ –∏ –ª–∏—Ü–µ–Ω–∑–∏—é
- **–ü–∞—Ç–µ–Ω—Ç–Ω–∞—è –∑–∞—â–∏—Ç–∞** - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–∞—Ç–µ–Ω—Ç–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ç–µ–∫—Å—Ç –ª–∏—Ü–µ–Ω–∑–∏–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ñ–∞–π–ª–µ [LICENSE](LICENSE).

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.
