# –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —á–∞—Ç-–∫–ª–∏–µ–Ω—Ç –¥–ª—è Kuznik Bot

## –û–±–∑–æ—Ä
–ö–æ–Ω—Å–æ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä—è–º–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Claude AI –±–µ–∑ Telegram, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
1. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å
2. **–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤** —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—á–µ—Ä–µ–∑ ConversationManager)
3. **Rate limiting** –∫–∞–∫ –≤ Telegram –≤–µ—Ä—Å–∏–∏ (—á–µ—Ä–µ–∑ RateLimiter)
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤**
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥**

### –ö–æ–º–∞–Ω–¥—ã:
- `/start` - –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü—Ä–∏–Ω—Ü–∏–ø—ã:
1. **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ª–æ–≥–∏–∫–∏** —Ä–∞–±–æ—Ç—ã —Å Claude
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–≥–æ –∂–µ handler** –¥–ª—è –∫–æ–º–∞–Ω–¥

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `AppConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- `ClaudeClient` - –æ–±—â–µ–Ω–∏–µ —Å Claude API
- `ConversationManager` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤
- `RateLimiter` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- `TelegramBotHandler` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞:

```
chat.rb                     # –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Å–æ–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ ConsoleChat            # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å
‚îÇ   ‚îú‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è      # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ TelegramBotHandler # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥!
‚îÇ   ‚îú‚îÄ‚îÄ –¶–∏–∫–ª –æ–±—â–µ–Ω–∏—è       # Readline + –≤—ã–∑–æ–≤ handler
‚îÇ   ‚îî‚îÄ‚îÄ –ê–¥–∞–ø—Ç–µ—Ä –≤—ã–≤–æ–¥–∞     # –ö–æ–Ω—Å–æ–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
‚îî‚îÄ‚îÄ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã    # –ë–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TelegramBotHandler:

```ruby
# –í–Ω—É—Ç—Ä–∏ ConsoleChat:
@bot_handler = TelegramBotHandler.new(
  @claude,
  @conversation_manager,
  @rate_limiter,
  @config
)

# –î–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π:
response = @bot_handler.handle_message(user_id, message)

# –î–ª—è –∫–æ–º–∞–Ω–¥:
response = @bot_handler.handle_command(user_id, command) # —Ç–æ–ª—å–∫–æ /start
```

### –ù–µ –∏–∑–º–µ–Ω—è—Ç—å:
- –Ø–¥—Ä–æ –±–æ—Ç–∞ (`lib/telegram_bot_handler.rb`)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (`config/app_config.rb`)
- Claude –∫–ª–∏–µ–Ω—Ç –∏ –º–µ–Ω–µ–¥–∂–µ—Ä –¥–∏–∞–ª–æ–≥–æ–≤
- –¢–µ—Å—Ç—ã

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `require_relative`:
```ruby
require_relative 'lib/app_config'
require_relative 'lib/claude_client'
require_relative 'lib/conversation_manager'
require_relative 'lib/rate_limiter'
require_relative 'lib/telegram_bot_handler'
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
1. **Readline** –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –≤–≤–æ–¥–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
2. **Signal handlers** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ Ctrl+C
3. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ConversationManager** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
4. **–¢–µ –∂–µ rate limits** —á—Ç–æ –∏ –≤ Telegram –≤–µ—Ä—Å–∏–∏
5. **–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –∫–∞–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–æ—Ç–µ

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞:
- –ü—Ä–æ—Å—Ç–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ Claude –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç" –≤–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç–≤–µ—Ç–æ–≤ Claude

## –ó–∞–ø—É—Å–∫ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–≥–æ —á–∞—Ç–∞
ruby chat.rb

# –ò–ª–∏ —Å–¥–µ–ª–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x chat.rb
./chat.rb
```

### –ü—Ä–∏–º–µ—Ä —Å–µ—Å—Å–∏–∏:
```
üöó Kuznik Bot - –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —á–∞—Ç —Å Claude AI
==================================================
üí¨ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º —á–∞—Ç–∞!
ü§ñ –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ–±—â–∞—Ç—å—Å—è —Å Claude –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞.

üí¨ –ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥. –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –ü—Ä–∏–≤–µ—Ç!
ü§ñ Claude –ø–µ—á–∞—Ç–∞–µ—Ç...

ü§ñ Claude:
  –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞ Kuznik. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?

ü§ñ –í—ã: –ö–∞–∫–∏–µ —É –≤–∞—Å —É—Å–ª—É–≥–∏?
ü§ñ Claude –ø–µ—á–∞—Ç–∞–µ—Ç...

ü§ñ Claude:
  –ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ–ª–Ω—ã–π —Å–ø–µ–∫—Ç—Ä —É—Å–ª—É–≥ –ø–æ —Ä–µ–º–æ–Ω—Ç—É –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π...
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞

- **–ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π** –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ
- **–ü–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥** –¥–ª—è –∫–æ–Ω—Å–æ–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫** –ø—Ä–∞–≤–¥—ã –¥–ª—è Claude –æ–±—â–µ–Ω–∏—è
- **–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –æ—à–∏–±–æ–∫ –∏ rate limiting
- **–¢–æ—Ç –∂–µ handler** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ `/start`

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Ruby >= 3.0
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ gem –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `ANTHROPIC_AUTH_TOKEN`
- –î–æ—Å—Ç—É–ø –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ñ–∞–π–ª–∞–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –¥–∞–Ω–Ω—ã–º

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `chat.rb` —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π ConsoleChat
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å TelegramBotHandler
4. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π