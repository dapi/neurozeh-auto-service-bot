<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="../assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="../assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul:nth-of-type(4) > li:not(:nth-child(2)) > a, .site-nav > ul:nth-of-type(4) > li > ul > li a { background-image: none; } .site-nav > ul:not(:nth-of-type(4)) a, .site-nav li.external a { background-image: none; } .site-nav > ul:nth-of-type(4) > li:nth-child(2) > a { font-weight: 600; text-decoration: none; } .site-nav > ul.nav-category-list > li > button svg, .site-nav > ul:nth-of-type(4) > li:nth-child(2) > button svg { transform: rotate(-90deg); } .site-nav > ul.nav-category-list > li.nav-list-item > ul.nav-list, .site-nav > ul:nth-of-type(4) > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; } </style> <script src="../assets/js/vendor/lunr.min.js"></script> <script src="../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="../assets/images/logo.svg" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Tools | RubyLLM</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Tools" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Let AI call your Ruby code. Connect to databases, APIs, or any external system with function calling." /> <meta property="og:description" content="Let AI call your Ruby code. Connect to databases, APIs, or any external system with function calling." /> <link rel="canonical" href="index.html" /> <meta property="og:url" content="https://rubyllm.com/tools/" /> <meta property="og:site_name" content="RubyLLM" /> <meta property="og:image" content="https://rubyllm.com/assets/images/og/core_features/tools.png" /> <meta property="og:image:height" content="600" /> <meta property="og:image:width" content="1200" /> <meta property="og:image:alt" content="Tools" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2025-10-22T09:47:33+00:00" /> <meta name="twitter:card" content="summary_large_image" /> <meta property="twitter:image" content="https://rubyllm.com/assets/images/og/core_features/tools.png" /> <meta name="twitter:image:alt" content="Tools" /> <meta property="twitter:title" content="Tools" /> <meta name="twitter:site" content="@paolino" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-10-22T09:47:33+00:00","datePublished":"2025-10-22T09:47:33+00:00","description":"Let AI call your Ruby code. Connect to databases, APIs, or any external system with function calling.","headline":"Tools","image":{"width":1200,"height":600,"alt":"Tools","url":"https://rubyllm.com/assets/images/og/core_features/tools.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rubyllm.com/tools/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://rubyllm.com/assets/images/logotype.svg"}},"url":"https://rubyllm.com/tools/"}</script> <!-- End Jekyll SEO tag --> <!-- Auto Dark Mode - Must run immediately to prevent flash --> <script src="../assets/js/auto-dark-mode.js"></script> <link rel="icon" type="image/png" href="../assets/images/favicon/favicon-96x96.png" sizes="96x96" /> <link rel="icon" type="image/svg+xml" href="../assets/images/logo.svg" /> <link rel="shortcut icon" href="../assets/images/favicon/favicon.ico" /> <link rel="apple-touch-icon" sizes="180x180" href="../assets/images/favicon/apple-touch-icon.png" /> <meta name="apple-mobile-web-app-title" content="RubyLLM" /> <link rel="manifest" href="../assets/images/favicon/site.webmanifest" /> <!-- Override Twitter card type to use large image --> <meta name="twitter:card" content="summary_large_image"> <script defer data-domain="rubyllm.com" src="https://stats.paolino.me/js/script.outbound-links.js"></script> </head> <body> <a class="skip-to-main" href="index.html#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="../index.html" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="RubyLLM"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="../index.html" class="nav-list-link">Home</a></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/crmne/ruby_llm" class="nav-list-link external" > GitHub <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li><li class="nav-list-item external"> <a href="https://github.com/crmne/ruby_llm/releases" class="nav-list-link external" > Changelog <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li><li class="nav-list-item external"> <a href="https://paolino.me" class="nav-list-link external" > Blog <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> <div class="nav-category">Getting Started</div> <ul class="nav-list"><li class="nav-list-item"><a href="../getting-started/index.html" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><a href="../overview/index.html" class="nav-list-link">Overview</a></li><li class="nav-list-item"><a href="../configuration/index.html" class="nav-list-link">Configuration</a></li></ul> <div class="nav-category">Core Features</div> <ul class="nav-list"><li class="nav-list-item"><a href="../chat/index.html" class="nav-list-link">Chat</a></li><li class="nav-list-item"><a href="index.html" class="nav-list-link">Tools</a></li><li class="nav-list-item"><a href="../streaming/index.html" class="nav-list-link">Stream Responses</a></li><li class="nav-list-item"><a href="../embeddings/index.html" class="nav-list-link">Embeddings</a></li><li class="nav-list-item"><a href="../image-generation/index.html" class="nav-list-link">Image Generation</a></li><li class="nav-list-item"><a href="../audio-transcription/index.html" class="nav-list-link">Audio Transcription</a></li><li class="nav-list-item"><a href="../moderation/index.html" class="nav-list-link">Moderation</a></li></ul> <div class="nav-category">Advanced</div> <ul class="nav-list"><li class="nav-list-item"><a href="../rails/index.html" class="nav-list-link">Rails Integration</a></li><li class="nav-list-item"><a href="../async/index.html" class="nav-list-link">Scale with Async</a></li><li class="nav-list-item"><a href="../error-handling/index.html" class="nav-list-link">Error Handling</a></li><li class="nav-list-item"><a href="../models/index.html" class="nav-list-link">Model Registry</a></li><li class="nav-list-item"><a href="../agentic-workflows/index.html" class="nav-list-link">Agentic Workflows</a></li><li class="nav-list-item"><a href="../upgrading/index.html" class="nav-list-link">Upgrading</a></li></ul> <div class="nav-category">Reference</div> <ul class="nav-list"><li class="nav-list-item"><a href="../available-models/index.html" class="nav-list-link">Available Models</a></li><li class="nav-list-item"><a href="../ecosystem/index.html" class="nav-list-link">RubyLLM Ecosystem</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search RubyLLM" aria-label="Search RubyLLM" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 class="no_toc" id="tools"> <a href="index.html#tools" class="anchor-heading" aria-labelledby="tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tools </h1> <p class="fs-6 fw-300">Let AI call your Ruby code. Connect to databases, APIs, or any external system with function calling.</p> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="index.html#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="index.html#what-are-tools" id="markdown-toc-what-are-tools">What Are Tools?</a></li> <li><a href="index.html#creating-a-tool" id="markdown-toc-creating-a-tool">Creating a Tool</a> <ol> <li><a href="index.html#tool-components" id="markdown-toc-tool-components">Tool Components</a></li> <li><a href="index.html#provider-specific-parameters" id="markdown-toc-provider-specific-parameters">Provider-Specific Parameters</a></li> </ol> </li> <li><a href="index.html#returning-rich-content-from-tools" id="markdown-toc-returning-rich-content-from-tools">Returning Rich Content from Tools</a></li> <li><a href="index.html#custom-initialization" id="markdown-toc-custom-initialization">Custom Initialization</a></li> <li><a href="index.html#using-tools-in-chat" id="markdown-toc-using-tools-in-chat">Using Tools in Chat</a> <ol> <li><a href="index.html#model-compatibility" id="markdown-toc-model-compatibility">Model Compatibility</a></li> </ol> </li> <li><a href="index.html#the-tool-execution-flow" id="markdown-toc-the-tool-execution-flow">The Tool Execution Flow</a></li> <li><a href="index.html#monitoring-tool-calls-with-callbacks" id="markdown-toc-monitoring-tool-calls-with-callbacks">Monitoring Tool Calls with Callbacks</a> <ol> <li><a href="index.html#example-limiting-tool-calls" id="markdown-toc-example-limiting-tool-calls">Example: Limiting Tool Calls</a></li> </ol> </li> <li><a href="index.html#advanced-halting-tool-continuation" id="markdown-toc-advanced-halting-tool-continuation">Advanced: Halting Tool Continuation</a> <ol> <li><a href="index.html#what-halt-does" id="markdown-toc-what-halt-does">What halt does</a></li> <li><a href="index.html#when-you-might-use-it" id="markdown-toc-when-you-might-use-it">When you might use it</a></li> <li><a href="index.html#example-with-sub-agents" id="markdown-toc-example-with-sub-agents">Example with sub-agents</a></li> </ol> </li> <li><a href="index.html#model-context-protocol-mcp-support" id="markdown-toc-model-context-protocol-mcp-support">Model Context Protocol (MCP) Support</a></li> <li><a href="index.html#debugging-tools" id="markdown-toc-debugging-tools">Debugging Tools</a></li> <li><a href="index.html#error-handling-in-tools" id="markdown-toc-error-handling-in-tools">Error Handling in Tools</a></li> <li><a href="index.html#security-considerations" id="markdown-toc-security-considerations">Security Considerations</a></li> <li><a href="index.html#next-steps" id="markdown-toc-next-steps">Next Steps</a></li> </ol><hr /> <p>After reading this guide, you will know:</p> <ul> <li>What Tools are and why they are useful.</li> <li>How to define a Tool using <code class="language-plaintext highlighter-rouge">RubyLLM::Tool</code>.</li> <li>How to define parameters for your Tools.</li> <li>How to use Tools within a <code class="language-plaintext highlighter-rouge">RubyLLM::Chat</code>.</li> <li>The execution flow when a model uses a Tool.</li> <li>How to handle errors within Tools.</li> <li>Security considerations when using Tools.</li> </ul> <h2 id="what-are-tools"> <a href="index.html#what-are-tools" class="anchor-heading" aria-labelledby="what-are-tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What Are Tools? </h2> <p>Tools bridge the gap between the AI model’s conversational abilities and the real world. They allow the model to delegate tasks it cannot perform itself to your application code.</p> <p>Common use cases:</p> <ul> <li><strong>Fetching Real-time Data:</strong> Get current stock prices, weather forecasts, news headlines, or sports scores.</li> <li><strong>Database Interaction:</strong> Look up customer information, product details, or order statuses.</li> <li><strong>Calculations:</strong> Perform precise mathematical operations or complex financial modeling.</li> <li><strong>External APIs:</strong> Interact with third-party services (e.g., send an email, book a meeting, control smart home devices).</li> <li><strong>Executing Code:</strong> Run specific business logic or algorithms within your application.</li> </ul> <h2 id="creating-a-tool"> <a href="index.html#creating-a-tool" class="anchor-heading" aria-labelledby="creating-a-tool"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating a Tool </h2> <p>Define a tool by creating a class that inherits from <code class="language-plaintext highlighter-rouge">RubyLLM::Tool</code>.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Weather</span> <span class="o">&lt;</span> <span class="no">RubyLLM</span><span class="o">::</span><span class="no">Tool</span>
  <span class="n">description</span> <span class="s2">"Gets current weather for a location"</span>
  <span class="n">param</span> <span class="ss">:latitude</span><span class="p">,</span> <span class="ss">desc: </span><span class="s2">"Latitude (e.g., 52.5200)"</span>
  <span class="n">param</span> <span class="ss">:longitude</span><span class="p">,</span> <span class="ss">desc: </span><span class="s2">"Longitude (e.g., 13.4050)"</span>

  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">latitude</span><span class="p">:,</span> <span class="n">longitude</span><span class="p">:)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://api.open-meteo.com/v1/forecast?latitude=</span><span class="si">#{</span><span class="n">latitude</span><span class="si">}</span><span class="s2">&amp;longitude=</span><span class="si">#{</span><span class="n">longitude</span><span class="si">}</span><span class="s2">&amp;current=temperature_2m,wind_speed_10m"</span>

    <span class="n">response</span> <span class="o">=</span> <span class="no">Faraday</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="p">{</span> <span class="ss">error: </span><span class="n">e</span><span class="p">.</span><span class="nf">message</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="tool-components"> <a href="index.html#tool-components" class="anchor-heading" aria-labelledby="tool-components"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tool Components </h3> <ol> <li><strong>Inheritance:</strong> Must inherit from <code class="language-plaintext highlighter-rouge">RubyLLM::Tool</code>.</li> <li><strong><code class="language-plaintext highlighter-rouge">description</code>:</strong> A class method defining what the tool does. Crucial for the AI model to understand its purpose. Keep it clear and concise.</li> <li><strong><code class="language-plaintext highlighter-rouge">param</code>:</strong> A class method used to define each input parameter. <ul> <li><strong>Name:</strong> The first argument (a symbol) is the parameter name. It will become a keyword argument in the <code class="language-plaintext highlighter-rouge">execute</code> method.</li> <li><strong><code class="language-plaintext highlighter-rouge">type:</code>:</strong> (Optional, defaults to <code class="language-plaintext highlighter-rouge">:string</code>) The expected data type. Common types include <code class="language-plaintext highlighter-rouge">:string</code>, <code class="language-plaintext highlighter-rouge">:integer</code>, <code class="language-plaintext highlighter-rouge">:number</code> (float), <code class="language-plaintext highlighter-rouge">:boolean</code>. Provider support for complex types like <code class="language-plaintext highlighter-rouge">:array</code> or <code class="language-plaintext highlighter-rouge">:object</code> varies. Stick to simple types for broad compatibility.</li> <li><strong><code class="language-plaintext highlighter-rouge">desc:</code>:</strong> (Required) A clear description of the parameter, explaining its purpose and expected format (e.g., “The city and state, e.g., San Francisco, CA”).</li> <li><strong><code class="language-plaintext highlighter-rouge">required:</code>:</strong> (Optional, defaults to <code class="language-plaintext highlighter-rouge">true</code>) Whether the AI <em>must</em> provide this parameter when calling the tool. Set to <code class="language-plaintext highlighter-rouge">false</code> for optional parameters and provide a default value in your <code class="language-plaintext highlighter-rouge">execute</code> method signature.</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">execute</code> Method:</strong> The instance method containing your Ruby code. It receives the parameters defined by <code class="language-plaintext highlighter-rouge">param</code> as keyword arguments. Its return value (typically a String or Hash) is sent back to the AI model.</li> </ol> <blockquote class="note"> <p>The tool’s class name is automatically converted to a snake_case name used in the API call (e.g., <code class="language-plaintext highlighter-rouge">WeatherLookup</code> becomes <code class="language-plaintext highlighter-rouge">weather_lookup</code>). This is how the LLM would call it. You can override this by defining a <code class="language-plaintext highlighter-rouge">name</code> method in your tool class:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">WeatherLookup</span> <span class="o">&lt;</span> <span class="no">RubyLLM</span><span class="o">::</span><span class="no">Tool</span>
  <span class="k">def</span> <span class="nf">name</span>
    <span class="s2">"Weather"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div> </div> </blockquote> <h3 class="d-inline-block" id="provider-specific-parameters"> <a href="index.html#provider-specific-parameters" class="anchor-heading" aria-labelledby="provider-specific-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Provider-Specific Parameters </h3> <p class="label label-green">v1.9.0+</p> <p>Some providers allow you to attach extra metadata to tool definitions (for example, Anthropic’s <code class="language-plaintext highlighter-rouge">cache_control</code> directive for prompt caching). Use <code class="language-plaintext highlighter-rouge">with_params</code> on your tool class to declare these once and RubyLLM will merge them into the API payload when the provider understands them.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TodoTool</span> <span class="o">&lt;</span> <span class="no">RubyLLM</span><span class="o">::</span><span class="no">Tool</span>
  <span class="n">description</span> <span class="s2">"Adds a task to the shared TODO list"</span>
  <span class="n">param</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">desc: </span><span class="s2">"Human-friendly task description"</span>

  <span class="n">with_params</span> <span class="ss">cache_control: </span><span class="p">{</span> <span class="ss">type: </span><span class="s1">'ephemeral'</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">title</span><span class="p">:)</span>
    <span class="no">Todo</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="n">title</span><span class="p">:)</span>
    <span class="s2">"Added “</span><span class="si">#{</span><span class="n">title</span><span class="si">}</span><span class="s2">” to the list."</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Provider-specific tool parameters are passed through verbatim. Use <code class="language-plaintext highlighter-rouge">RUBYLLM_DEBUG=true</code> and keep an eye on your logs when rolling out new metadata.</p> <h2 id="returning-rich-content-from-tools"> <a href="index.html#returning-rich-content-from-tools" class="anchor-heading" aria-labelledby="returning-rich-content-from-tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Returning Rich Content from Tools </h2> <p>Tools can return <code class="language-plaintext highlighter-rouge">RubyLLM::Content</code> objects with file attachments, allowing you to pass images, documents, or other files from your tools to the AI model:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AnalyzeTool</span> <span class="o">&lt;</span> <span class="no">RubyLLM</span><span class="o">::</span><span class="no">Tool</span>
  <span class="n">description</span> <span class="s2">"Analyzes data and returns results with visualizations"</span>
  <span class="n">param</span> <span class="ss">:query</span><span class="p">,</span> <span class="ss">desc: </span><span class="s2">"Analysis query"</span>

  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">:)</span>
    <span class="c1"># Generate analysis and create visualization</span>
    <span class="n">chart_path</span> <span class="o">=</span> <span class="n">generate_chart</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="c1"># Return Content with text and attachments</span>
    <span class="no">RubyLLM</span><span class="o">::</span><span class="no">Content</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
      <span class="s2">"Analysis complete for: </span><span class="si">#{</span><span class="n">query</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
      <span class="p">[</span><span class="n">chart_path</span><span class="p">]</span>  <span class="c1"># Attach the generated chart (array of paths/blobs)</span>
    <span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">generate_chart</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="c1"># Your chart generation logic</span>
    <span class="s2">"/tmp/chart_</span><span class="si">#{</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_i</span><span class="si">}</span><span class="s2">.png"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">chat</span> <span class="o">=</span> <span class="no">RubyLLM</span><span class="p">.</span><span class="nf">chat</span><span class="p">.</span><span class="nf">with_tool</span><span class="p">(</span><span class="no">AnalyzeTool</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="s2">"Analyze sales trends for Q4"</span><span class="p">)</span>
<span class="c1"># The AI receives both the text and the chart image</span>
</code></pre></div></div> <p>When a tool returns a <code class="language-plaintext highlighter-rouge">Content</code> object:</p> <ul> <li>The text and attachments are preserved in the conversation history</li> <li>Vision-capable models can see and analyze attached images</li> <li>The AI can reference the attachments in its response</li> </ul> <p>This is particularly useful for:</p> <ul> <li><strong>Data visualization:</strong> Return charts, graphs, or diagrams</li> <li><strong>Document processing:</strong> Pass PDFs or documents for the AI to analyze</li> <li><strong>Image generation:</strong> Return generated or processed images</li> <li><strong>Multi-modal workflows:</strong> Combine text results with visual elements</li> </ul> <h2 id="custom-initialization"> <a href="index.html#custom-initialization" class="anchor-heading" aria-labelledby="custom-initialization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Custom Initialization </h2> <p>Tools can have custom initialization:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DocumentSearch</span> <span class="o">&lt;</span> <span class="no">RubyLLM</span><span class="o">::</span><span class="no">Tool</span>
  <span class="n">description</span> <span class="s2">"Searches documents by relevance"</span>

  <span class="n">param</span> <span class="ss">:query</span><span class="p">,</span>
    <span class="ss">desc: </span><span class="s2">"The search query"</span>

  <span class="n">param</span> <span class="ss">:limit</span><span class="p">,</span>
    <span class="ss">type: :integer</span><span class="p">,</span>
    <span class="ss">desc: </span><span class="s2">"Maximum number of results"</span><span class="p">,</span>
    <span class="ss">required: </span><span class="kp">false</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
    <span class="vi">@database</span> <span class="o">=</span> <span class="n">database</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">:,</span> <span class="ss">limit: </span><span class="mi">5</span><span class="p">)</span>
    <span class="c1"># Search in @database</span>
    <span class="vi">@database</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="ss">limit: </span><span class="n">limit</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Initialize with dependencies</span>
<span class="n">search_tool</span> <span class="o">=</span> <span class="no">DocumentSearch</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">MyDatabase</span><span class="p">)</span>
<span class="n">chat</span><span class="p">.</span><span class="nf">with_tool</span><span class="p">(</span><span class="n">search_tool</span><span class="p">)</span>
</code></pre></div></div> <h2 id="using-tools-in-chat"> <a href="index.html#using-tools-in-chat" class="anchor-heading" aria-labelledby="using-tools-in-chat"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using Tools in Chat </h2> <p>Attach tools to a <code class="language-plaintext highlighter-rouge">Chat</code> instance using <code class="language-plaintext highlighter-rouge">with_tool</code> or <code class="language-plaintext highlighter-rouge">with_tools</code>.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a chat instance</span>
<span class="n">chat</span> <span class="o">=</span> <span class="no">RubyLLM</span><span class="p">.</span><span class="nf">chat</span><span class="p">(</span><span class="ss">model: </span><span class="s1">'gpt-4.1'</span><span class="p">)</span> <span class="c1"># Use a model that supports tools</span>

<span class="c1"># Instantiate your tool if it requires arguments, otherwise use the class</span>
<span class="n">weather_tool</span> <span class="o">=</span> <span class="no">Weather</span><span class="p">.</span><span class="nf">new</span>

<span class="c1"># Add the tool(s) to the chat</span>
<span class="n">chat</span><span class="p">.</span><span class="nf">with_tool</span><span class="p">(</span><span class="n">weather_tool</span><span class="p">)</span>
<span class="c1"># Or add multiple: chat.with_tools(WeatherLookup, AnotherTool.new)</span>

<span class="c1"># Replace all tools with new ones</span>
<span class="n">chat</span><span class="p">.</span><span class="nf">with_tools</span><span class="p">(</span><span class="no">NewTool</span><span class="p">,</span> <span class="no">AnotherTool</span><span class="p">,</span> <span class="ss">replace: </span><span class="kp">true</span><span class="p">)</span>

<span class="c1"># Clear all tools</span>
<span class="n">chat</span><span class="p">.</span><span class="nf">with_tools</span><span class="p">(</span><span class="ss">replace: </span><span class="kp">true</span><span class="p">)</span>

<span class="c1"># Ask a question that should trigger the tool</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">.</span><span class="nf">ask</span> <span class="s2">"What's the current weather like in Berlin? (Lat: 52.52, Long: 13.40)"</span>
<span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">content</span>
<span class="c1"># =&gt; "Current weather at 52.52, 13.4: Temperature: 12.5°C, Wind Speed: 8.3 km/h, Conditions: Mainly clear, partly cloudy, and overcast."</span>
</code></pre></div></div> <h3 id="model-compatibility"> <a href="index.html#model-compatibility" class="anchor-heading" aria-labelledby="model-compatibility"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Model Compatibility </h3> <p>RubyLLM will attempt to use tools with any model. If the model doesn’t support function calling, the provider will return an appropriate error when you call <code class="language-plaintext highlighter-rouge">ask</code>.</p> <h2 id="the-tool-execution-flow"> <a href="index.html#the-tool-execution-flow" class="anchor-heading" aria-labelledby="the-tool-execution-flow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Tool Execution Flow </h2> <p>When you <code class="language-plaintext highlighter-rouge">ask</code> a question that the model determines requires a tool:</p> <ol> <li><strong>User Query:</strong> Your message is sent to the model.</li> <li><strong>Model Decision:</strong> The model analyzes the query and its available tools (based on their descriptions). It decides the <code class="language-plaintext highlighter-rouge">WeatherLookup</code> tool is needed and extracts the latitude and longitude.</li> <li><strong>Tool Call Request:</strong> The model responds <em>not</em> with text, but with a special message indicating a tool call, including the tool name (<code class="language-plaintext highlighter-rouge">weather_lookup</code>) and arguments (<code class="language-plaintext highlighter-rouge">{ latitude: 52.52, longitude: 13.40 }</code>).</li> <li><strong>RubyLLM Execution:</strong> RubyLLM receives this tool call request. It finds the registered <code class="language-plaintext highlighter-rouge">WeatherLookup</code> tool and calls its <code class="language-plaintext highlighter-rouge">execute(latitude: 52.52, longitude: 13.40)</code> method.</li> <li><strong>Tool Result:</strong> Your <code class="language-plaintext highlighter-rouge">execute</code> method runs (calling the weather API) and returns a result string.</li> <li><strong>Result Sent Back:</strong> RubyLLM sends this result back to the AI model in a new message with the <code class="language-plaintext highlighter-rouge">:tool</code> role.</li> <li><strong>Final Response Generation:</strong> The model receives the tool result and uses it to generate a natural language response to your original query.</li> <li><strong>Final Response Returned:</strong> RubyLLM returns the final <code class="language-plaintext highlighter-rouge">RubyLLM::Message</code> object containing the text generated in step 7.</li> </ol> <p>This entire multi-step process happens behind the scenes within a single <code class="language-plaintext highlighter-rouge">chat.ask</code> call when a tool is invoked.</p> <h2 id="monitoring-tool-calls-with-callbacks"> <a href="index.html#monitoring-tool-calls-with-callbacks" class="anchor-heading" aria-labelledby="monitoring-tool-calls-with-callbacks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monitoring Tool Calls with Callbacks </h2> <p>You can monitor tool execution using event callbacks to track when tools are called and what they return:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">chat</span> <span class="o">=</span> <span class="no">RubyLLM</span><span class="p">.</span><span class="nf">chat</span><span class="p">(</span><span class="ss">model: </span><span class="s1">'gpt-4.1'</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">with_tool</span><span class="p">(</span><span class="no">Weather</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">on_tool_call</span> <span class="k">do</span> <span class="o">|</span><span class="n">tool_call</span><span class="o">|</span>
        <span class="c1"># Called when the AI decides to use a tool</span>
        <span class="nb">puts</span> <span class="s2">"Calling tool: </span><span class="si">#{</span><span class="n">tool_call</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">"</span>
        <span class="nb">puts</span> <span class="s2">"Arguments: </span><span class="si">#{</span><span class="n">tool_call</span><span class="p">.</span><span class="nf">arguments</span><span class="si">}</span><span class="s2">"</span>
      <span class="k">end</span>
      <span class="p">.</span><span class="nf">on_tool_result</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
        <span class="c1"># Called after the tool returns its result</span>
        <span class="nb">puts</span> <span class="s2">"Tool returned: </span><span class="si">#{</span><span class="n">result</span><span class="si">}</span><span class="s2">"</span>
      <span class="k">end</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">.</span><span class="nf">ask</span> <span class="s2">"What's the weather in Paris?"</span>
<span class="c1"># Output:</span>
<span class="c1"># Calling tool: weather</span>
<span class="c1"># Arguments: {"latitude": "48.8566", "longitude": "2.3522"}</span>
<span class="c1"># Tool returned: {"temperature": 15, "conditions": "Partly cloudy"}</span>
</code></pre></div></div> <p>These callbacks are useful for:</p> <ul> <li><strong>Logging and Analytics:</strong> Track which tools are used most frequently</li> <li><strong>UI Updates:</strong> Show loading states or progress indicators</li> <li><strong>Debugging:</strong> Monitor tool inputs and outputs in production</li> <li><strong>Auditing:</strong> Record tool usage for compliance or billing</li> </ul> <h3 id="example-limiting-tool-calls"> <a href="index.html#example-limiting-tool-calls" class="anchor-heading" aria-labelledby="example-limiting-tool-calls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example: Limiting Tool Calls </h3> <p>To prevent excessive API usage or infinite loops, you can use callbacks to limit tool calls:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Limit total tool calls per conversation</span>
<span class="n">call_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">max_calls</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">chat</span> <span class="o">=</span> <span class="no">RubyLLM</span><span class="p">.</span><span class="nf">chat</span><span class="p">(</span><span class="ss">model: </span><span class="s1">'gpt-4.1'</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">with_tool</span><span class="p">(</span><span class="no">Weather</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">on_tool_call</span> <span class="k">do</span> <span class="o">|</span><span class="n">tool_call</span><span class="o">|</span>
        <span class="n">call_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">call_count</span> <span class="o">&gt;</span> <span class="n">max_calls</span>
          <span class="k">raise</span> <span class="s2">"Tool call limit exceeded (</span><span class="si">#{</span><span class="n">max_calls</span><span class="si">}</span><span class="s2"> calls)"</span>
        <span class="k">end</span>
      <span class="k">end</span>

<span class="c1"># The conversation will stop if it tries to use tools more than 10 times</span>
<span class="n">chat</span><span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="s2">"Check weather for every major city..."</span><span class="p">)</span>
</code></pre></div></div> <blockquote class="warning"> <p>Raising an exception in <code class="language-plaintext highlighter-rouge">on_tool_call</code> breaks the conversation flow - the LLM expects a tool response after requesting a tool call. This can leave the chat in an inconsistent state. Consider using better models or clearer tool descriptions to prevent loops instead of hard limits.</p> </blockquote> <h2 id="advanced-halting-tool-continuation"> <a href="index.html#advanced-halting-tool-continuation" class="anchor-heading" aria-labelledby="advanced-halting-tool-continuation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Advanced: Halting Tool Continuation </h2> <p>After a tool executes, the LLM normally continues the conversation to explain what happened. In rare cases, you might want to skip this and return the tool result directly.</p> <h3 id="what-halt-does"> <a href="index.html#what-halt-does" class="anchor-heading" aria-labelledby="what-halt-does"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What halt does </h3> <p>The <code class="language-plaintext highlighter-rouge">halt</code> helper stops the LLM from continuing after your tool:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SaveFileTool</span> <span class="o">&lt;</span> <span class="no">RubyLLM</span><span class="o">::</span><span class="no">Tool</span>
  <span class="n">description</span> <span class="s2">"Save content to a file"</span>
  <span class="n">param</span> <span class="ss">:path</span><span class="p">,</span> <span class="ss">desc: </span><span class="s2">"File path"</span>
  <span class="n">param</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">desc: </span><span class="s2">"File content"</span>

  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">path</span><span class="p">:,</span> <span class="n">content</span><span class="p">:)</span>
    <span class="no">File</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
    <span class="n">halt</span> <span class="s2">"Saved to </span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="s2">"</span>  <span class="c1"># Returns this directly, no LLM commentary</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Without halt: LLM adds "I've successfully saved the file to config.yml..."</span>
<span class="c1"># With halt: Just returns "Saved to config.yml"</span>
</code></pre></div></div> <h3 id="when-you-might-use-it"> <a href="index.html#when-you-might-use-it" class="anchor-heading" aria-labelledby="when-you-might-use-it"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> When you might use it </h3> <ul> <li><strong>Token savings:</strong> Skip the LLM’s summary for simple confirmations</li> <li><strong>Sub-agent delegation:</strong> When another agent fully handles the response</li> <li><strong>Precise responses:</strong> When you need exact output without LLM interpretation</li> </ul> <blockquote class="warning"> <p>The LLM’s continuation is usually helpful - it provides context and natural language formatting. Only use <code class="language-plaintext highlighter-rouge">halt</code> when you specifically need to bypass this behavior.</p> </blockquote> <h3 id="example-with-sub-agents"> <a href="index.html#example-with-sub-agents" class="anchor-heading" aria-labelledby="example-with-sub-agents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example with sub-agents </h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DelegateTool</span> <span class="o">&lt;</span> <span class="no">RubyLLM</span><span class="o">::</span><span class="no">Tool</span>
  <span class="n">description</span> <span class="s2">"Delegate to expert"</span>
  <span class="n">param</span> <span class="ss">:query</span><span class="p">,</span> <span class="ss">desc: </span><span class="s2">"The query"</span>

  <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">:)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">RubyLLM</span><span class="p">.</span><span class="nf">chat</span>
      <span class="p">.</span><span class="nf">with_instructions</span><span class="p">(</span><span class="s2">"You are an expert..."</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">ask</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">chunk</span><span class="o">|</span> <span class="nb">print</span> <span class="n">chunk</span> <span class="p">}</span>  <span class="c1"># Stream to user</span>
    <span class="n">halt</span> <span class="n">response</span><span class="p">.</span><span class="nf">content</span>  <span class="c1"># Skip router's commentary</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <blockquote class="note"> <p><strong>Sub-agents work perfectly without halt!</strong> You can create sub-agents and stream their responses without using <code class="language-plaintext highlighter-rouge">halt</code>. The router will simply summarize what the sub-agent said, which is often helpful. Use <code class="language-plaintext highlighter-rouge">halt</code> only when you specifically want to skip the router’s summary.</p> </blockquote> <h2 id="model-context-protocol-mcp-support"> <a href="index.html#model-context-protocol-mcp-support" class="anchor-heading" aria-labelledby="model-context-protocol-mcp-support"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Model Context Protocol (MCP) Support </h2> <p>For MCP server integration, check out the community-maintained <a href="https://github.com/patvice/ruby_llm-mcp"><code class="language-plaintext highlighter-rouge">ruby_llm-mcp</code></a> gem.</p> <h2 id="debugging-tools"> <a href="index.html#debugging-tools" class="anchor-heading" aria-labelledby="debugging-tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debugging Tools </h2> <p>Set the <code class="language-plaintext highlighter-rouge">RUBYLLM_DEBUG</code> environment variable to see detailed logging, including tool calls and results.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">RUBYLLM_DEBUG</span><span class="o">=</span><span class="nb">true</span>
<span class="c"># Run your script</span>
</code></pre></div></div> <p>You’ll see log lines similar to:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>D, [timestamp] -- RubyLLM: Tool weather_lookup called with: {:latitude=&gt;52.52, :longitude=&gt;13.4}
D, [timestamp] -- RubyLLM: Tool weather_lookup returned: "Current weather at 52.52, 13.4: Temperature: 12.5°C, Wind Speed: 8.3 km/h, Conditions: Mainly clear, partly cloudy, and overcast."
</code></pre></div></div> <p>See the <a href="../error-handling/index.html#debugging">Error Handling Guide</a> for more on debugging.</p> <h2 id="error-handling-in-tools"> <a href="index.html#error-handling-in-tools" class="anchor-heading" aria-labelledby="error-handling-in-tools"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Handling in Tools </h2> <p>Tools should handle errors based on whether they’re recoverable:</p> <ul> <li><strong>Recoverable errors</strong> (invalid parameters, external API failures): Return <code class="language-plaintext highlighter-rouge">{ error: "description" }</code></li> <li><strong>Unrecoverable errors</strong> (missing configuration, database down): Raise an exception</li> </ul> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">location</span><span class="p">:)</span>
  <span class="k">return</span> <span class="p">{</span> <span class="ss">error: </span><span class="s2">"Location too short"</span> <span class="p">}</span> <span class="k">if</span> <span class="n">location</span><span class="p">.</span><span class="nf">length</span> <span class="o">&lt;</span> <span class="mi">3</span>

  <span class="c1"># Fetch weather data...</span>
<span class="k">rescue</span> <span class="no">Faraday</span><span class="o">::</span><span class="no">ConnectionFailed</span>
  <span class="p">{</span> <span class="ss">error: </span><span class="s2">"Weather service unavailable"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div> <p>See the <a href="../error-handling/index.html#handling-errors-within-tools">Error Handling Guide</a> for more discussion.</p> <h2 id="security-considerations"> <a href="index.html#security-considerations" class="anchor-heading" aria-labelledby="security-considerations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Security Considerations </h2> <blockquote class="warning"> <p>Treat any arguments passed to your <code class="language-plaintext highlighter-rouge">execute</code> method as potentially untrusted user input, as the AI model generates them based on the conversation.</p> </blockquote> <ul> <li><strong>NEVER</strong> use methods like <code class="language-plaintext highlighter-rouge">eval</code>, <code class="language-plaintext highlighter-rouge">system</code>, <code class="language-plaintext highlighter-rouge">send</code>, or direct SQL interpolation with raw arguments from the AI.</li> <li><strong>Validate and Sanitize:</strong> Always validate parameter types, ranges, formats, and allowed values. Sanitize strings to prevent injection attacks if they are used in database queries or system commands (though ideally, avoid direct system commands).</li> <li><strong>Principle of Least Privilege:</strong> Ensure the code within <code class="language-plaintext highlighter-rouge">execute</code> only has access to the resources it absolutely needs.</li> </ul> <h2 id="next-steps"> <a href="index.html#next-steps" class="anchor-heading" aria-labelledby="next-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Next Steps </h2> <ul> <li><a href="../chat/index.html">Chatting with AI Models</a></li> <li><a href="../streaming/index.html">Streaming Responses</a> (See how tools interact with streaming)</li> <li><a href="../rails/index.html">Rails Integration</a> (Persisting tool calls and results)</li> <li><a href="../error-handling/index.html">Error Handling</a></li> </ul> </main> <hr> <footer> Brought to you by <a href="https://paolino.me">Carmine Paolino</a>, maker of <a href="https://chatwithwork.com"><img src="https://chatwithwork.com/logotype.svg" alt="Chat with Work" class="chatwithwork-logo" style="height: 1.8em; vertical-align: middle; margin: 0 0.25em;"></a> <em style="font-size: 0.85em; opacity: 0.8;">— Claude Code for your documents</em> <div class="d-flex mt-2"> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
